% xelatex (use Makefile)
\documentclass[twoside,twocolumn,9pt]{extbook} % extbook allows for smaller font sizes.

% Packages that don't necessary belong elsewhere.
\usepackage{mathtools} % For underlining. This seems like a bad joke. There's got to be a better way to underline (especially one that doesn't involve loading a massive package).
\usepackage{textcomp} % For copyleft symbol.

% Page layout options
% \usepackage[paperwidth=4.6in, paperheight=6in, margin=1cm]{geometry} % Small size, like my personal scriptures.
\usepackage[paperwidth=5.75in, paperheight=8.5in, top=1in, bottom=1in, left=0.5in, right=0.5in]{geometry} % The size of Virginia Tufte's Syntax as Style
\setlength{\topmargin}{-0.7in} % Relative to 1in default
\setlength{\headsep}{0.1cm} % Distance from header to top of text

\usepackage{multicol} % For copyright page. Possibly for poetry.

% Hyphen penalty (higher number more greatly discourages hyphenation, up to 10000).
% 4000 seems to work fine because it only allows hyphenation in extreme conditions (and doesn't require having to use ~ all the time). 8000 was previously being used but anything with a badness over 5000 is ugly to the naked eye, so 4000 is now being used (5000 wasn't enough because it allowed things in the range 4800--5200).
% Never use 10000.
\sloppy\hyphenpenalty=4000

% %%%%%%%%%%%%%%%%%%
%     APPENDICES
% %%%%%%%%%%%%%%%%%%
\usepackage[toc,page]{appendix}

% %%%%%%%%%%%%%%%%%%%%%%%%%%%
%     CHAPTER and SECTION
% %%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[explicit]{titlesec}

% Options for reconfiguring book (\chapter{}) headings.
\titleformat{\chapter}[display]{\centering\normalfont\Huge}{}{0ex}{#1}

% Spacing around book (\chapter{}) headers.
\titlespacing*{\chapter}{0pt}{0pt}{7ex}

% Options for reconfiguring chapter (\section{}) headings.
\titleformat{\section}{\centering}{}{1em}{#1}

% Options for reconfiguring preface (\subsection*{}) headings.
\titleformat{\subsection}{\large\bfseries}{}{1em}{#1}

% Shorter way of declaring a chapter with both a Hebrew and an English name.
\newcommand\chap[2]{%
    \chapter[#1\hfill#2~~~]{#1}% ~ added for spacing in ToC.
    \renewcommand\chaptername{#2}%
    \thispagestyle{empty}% Forces no page number in cfoot.
}

% More changes happen within the actual document (below). This is because the Appendix needs different styles.

% %%%%%%%%%%%%%%%%%%%%%%%%
%     CHAPTER HEADINGS
% %%%%%%%%%%%%%%%%%%%%%%%%
\newcommand\heading[1]{%
    \vspace{-0.5em}%
    {\small\emph{#1.}}%
    \vspace{0.5em}%
}

% %%%%%%%%%%%%%%%%%
%     ENUMERATE
% %%%%%%%%%%%%%%%%%
% NOTE: Do not \usepackage{paralist} because it conflicts with options set for enumitem.

% Changes spacing inside enumerate environment. TODO: Change to center.
\usepackage{enumitem}
\setenumerate{leftmargin=0em, itemindent=2.2em, listparindent=-1em, nolistsep}
% itemindent = distance from left margin to start of label

% Center aligns number.
\SetLabelAlign{center}{\hfil#1\hfil}

% Changes enumerate label to be a number without a period following it.
\renewcommand\labelenumi{\arabic{enumi}}

% %%%%%%%%%%%%%
%     FONTS
% %%%%%%%%%%%%%
\usepackage{xltxtra}

% Egyptian hieroglyphs
\usepackage{graphicx}

% Greek
\newfontfamily{\sblg}[Script=Greek,Scale=1.2]{SBL Greek}
\newcommand\Greek[1]{{\sblg #1}}

% Hebrew
\newfontfamily{\sblh}[Script=Hebrew,Scale=1.2]{SBL Hebrew}
\newcommand\Hebrew[1]{{\sblh #1}}

% Hoefler text
% \usepackage{fontspec}
% \setromanfont[Mapping=tex-text]{Hoefler Text}
% \fontspec[Mapping=tex-text, Ligatures={Common, Rare, Historic}]{Hoefler Text}
% \newfontinstance\scshape[Letters=SmallCaps, Numbers=Uppercase]{Hoefler Text}

% Phoenician
\usepackage{phoenician}

% Syriac
\newfontfamily{\sbls}[Script=Syriac]{Estrangelo (V1.1)}
\newcommand\Syriac[1]{{\large\sbls #1}}

% %%%%%%%%%%%%%%%%%
%     FOOTNOTES
% %%%%%%%%%%%%%%%%%
% Resets footnote numbering for each page (perpage) and adds the symbol option to number footnotes according to verse.
% Allows footnotes to be separated by a comma (multiple).
% Hang and flushmargin remove the indentation.
\usepackage[symbol,perpage,multiple,hang,flushmargin]{footmisc}

% Makes footnotes lowercase, italic alpha instead of Arabic numerals.
\renewcommand{\thefootnote}{\textit\alph{footnote}}

% Force footnotes to stay on the same page and not bleed over. Long footnotes should be placed in the appendix.
\interfootnotelinepenalty=10000

% %%%%%%%%%%%%%%%%%%%%%%%%%
%     HEADER and FOOTER
% %%%%%%%%%%%%%%%%%%%%%%%%%
% Header options for dictionary style headers.
\usepackage{fancyhdr}
\pagestyle{fancy}
\usepackage{fix2col} % Fixes potential problems with marks on two column pages.
\usepackage{substr}

% Extracts book name and chapters from rightmark and leftmark.
\newcommand\bookname{\BeforeSubString{^}{\leftmark}}
\newcommand\rightchap{\BehindSubString{^}{\rightmark}}
\newcommand\leftchap{\BehindSubString{^}{\leftmark}}
\fancyhead[LE]{~\rightchap} % The "~" is for cushioning.
\fancyhead[RO]{\leftchap~}
\fancyhead[LO,RE]{~\thepage~}
\fancyhead[CE]{\bookname} % Puts book name (e.g., Genesis, Exodus) in center header on even pages.
\fancyhead[CO]{\chaptername} % Puts Hebrew book name in center header on odd pages.
\cfoot{} % Removes page number from center foot.

% %%%%%%%%%%%%%%%%%%%%%%%%%
%     TABLE OF CONTENTS
% %%%%%%%%%%%%%%%%%%%%%%%%%
\AtBeginDocument{\addtocontents{toc}{\protect\thispagestyle{empty}}} % Removes page numbering from TOC.
\usepackage[toc]{multitoc} % Two column TOC.
\setcounter{tocdepth}{0} % So TOC only displays chapters (books).
\def\numberline#1{} % Removes numbering from TOC but not from sections (chapters).

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     VERSES and REFERENCES
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Patch enumi counter to always start with 1.
\usepackage{etoolbox}
\newcounter{myc}[enumi]
\patchcmd{\enumi}{}{\setcounter{myc}{1}}{}{}

\renewcommand\verse[1]{%
    \markboth{#1}{#1}% Sets up header. Stores #1 as both \leftmark and \rightmark.
    \label{#1}% Reference name.
    \item% Print verse number.
}

% POETRY
% Note: Don't use smaller text because then the (entire) book of Isaiah will be tiny.
\newcommand\pverse[2]{%
    \markboth{#1}{#1}% Sets up header. Stores #1 as both \leftmark and \rightmark
    \label{#1}% Reference name.
    \item {\small #2}% Print verse number and contents.
}

% For referencing a verse.
\newcommand\vref[1]{\hyperref[#1]{#1}}

% %%%%%%%%%%%%
%     YEAR
% %%%%%%%%%%%%
\usepackage{datetime}
\newdateformat{justtheyear}{\THEYEAR}

% %%%%%%%%%%%%%%%%
%     HYPERREF
% %%%%%%%%%%%%%%%%
% hyperfootnotes must be turned to 'false' for commas to appear in instances of multiple footnotes.
% \usepackage[xetex, hyperfootnotes=false, colorlinks=false, pdfborder={0 0 0}, pdftitle={The Holy Bible}, pdfauthor={Colby Goettel}, pdfproducer={pdfLaTeX}, pagebackref, pdfpagemode=None]{hyperref}

% %%%%%%%%%%%%%%%%
%     DOCUMENT
% %%%%%%%%%%%%%%%%
\begin{document}
    \frontmatter
    \input{half-title}
    \clearpage\thispagestyle{empty}
    \input{title-page}
    \clearpage\thispagestyle{empty}
    \input{license}
    \clearpage\thispagestyle{empty}
    \input{dedication}
    \clearpage\thispagestyle{empty}
    \input{preface}
    {\pagestyle{empty}\cleardoublepage}
    \tableofcontents
    \clearpage\thispagestyle{empty}
    \mainmatter
    % openrightfalse forces TeX to not generate a blank page between chapters.
    \makeatletter\@openrightfalse
    \chap{Genesis}{\Hebrew{בראשית}}
    \input{Genesis/1}
    % Genesis 10:25 --- Peleg and the countries being split up probably refers to the nations and not the tectonic plates.
    \input{Genesis/17}
    \input{Genesis/22}
    % \input{Genesis/31}
    % Whenever you get to the coat of many colors: \Hebrew{כְּתֹבֶת פּסִּים} \Greek{χιτῶνα ποικίλον} is rendered as \emph{coat of many colors}. Rabbis tell us that this is more probably a long sleeve garment with markings. Additionally, this is a \emph{hapax legomenon}.
    % \input{Genesis/49}
    \chap{Exodus}{\Hebrew{שמות}}
    \input{Exodus/19}
    \input{Exodus/20}
    \input{Exodus/21}
    \input{Exodus/23}
    \input{Exodus/24}
    \chap{Numbers}{\Hebrew{במדבר}}
    \input{Numbers/5}
    \input{Numbers/6}
    \input{Numbers/10}
    \input{Numbers/11}
    \input{Numbers/12}
    \chap{Deuteronomy}{\Hebrew{דברים}}
    \input{Deuteronomy/5}
    \input{Deuteronomy/6}
    \input{Deuteronomy/25}
    \chap{Joshua}{\Hebrew{יהושע}}
    \input{Joshua/3}
    \chap{Judges}{\Hebrew{שופטים}}
    \input{Judges/7}
    \chap{Ruth}{\Hebrew{רות}}
    \input{Ruth/1}
    \input{Ruth/2}
    \input{Ruth/3}
    \input{Ruth/4}
    \chap{1 Samuel}{\Hebrew{א שמואל}}
    \input{1Samuel/15}
    \chap{2 Samuel}{\Hebrew{ב שמואל}}
    \input{2Samuel/6}
    \chap{1 Kings}{\Hebrew{א מלכים}}
    \input{1Kings/17}
    \input{1Kings/18}
    \chap{2 Kings}{\Hebrew{ב מלכים}}
    \input{2Kings/2}
    \input{2Kings/5}
    \input{2Kings/6}
    \chap{2 Chronicles}{\Hebrew{ב הימים דברי}}
    \input{2Chronicles/26}
    \input{2Chronicles/31}
    \chap{Ezra}{\Hebrew{עזרא}}
    \input{Ezra/4}
    \input{Ezra/5}
    \input{Ezra/6}
    \input{Ezra/7}
    \chap{Nehemiah}{\Hebrew{נחמיה}}
    \input{Nehemiah/6}
    % psalm 2: Kingship/temple kind of psalm
    % Psalm 15:4:
    % footnote c, Greek "to his neighbor, fellow companion"
    % footnote d, Perhaps you could insert the writing "and does not turn away from (that) evil \Hebrew{בְּרָע}" [in other words, what was already put in explanatory brackets]
    % \input{Psalms/110} % Add reference to Appendix on psalm 110
    \chap{Isaiah}{\Hebrew{ישעה}}
    {\noindent\heading{See Appendix~\ref{app:isaiah} for more information on the book of Isaiah}}
    \input{Isaiah/1}
    \input{Isaiah/2}
    \input{Isaiah/36}
    \chap{Jeremiah}{\Hebrew{ירמיה}}
    \input{Jeremiah/3}
    \chap{Daniel}{\Hebrew{דניאל}}
    \input{Daniel/2}
    \input{Daniel/3}
    % In Malachi, add a reference to Appendix on yada for whatever verse talks about marriage
    \chap{Obadiah}{\Hebrew{עבדיה}}
    \input{Obadiah/1}
    \chap{Zephaniah}{\Hebrew{צפניה}}
    \input{Zephaniah/1}
    \chap{Malachi}{\Hebrew{מלאכי}}
    \input{Malachi/3}
    \input{Malachi/4}
    \appendix
    % Redefine \chapter for use in \appendix.
    \titleformat{\chapter}[display]{\centering\normalfont\LARGE}{}{0ex}{Appendix \thechapter: #1}
    % Change spacing around \chapter in \appendix.
    \titlespacing*{\chapter}{0em}{-5ex}{5ex}
    % Redefine \section so that it is used instead of \subsection in appendices.
    \titlespacing*{\section}{0em}{0.65em}{0.65em}
    \titleformat{\section}{\large\bfseries}{}{1em}{#1}
    \titlespacing*{\subsection}{0em}{0.65em}{0.65em}
    \titleformat{\subsection}{\bfseries}{}{1.25em}{#1} % Set to 1.25em so \section and \subsection are vertically aligned.
    ~\clearpage\thispagestyle{empty}
    ~\clearpage\thispagestyle{empty}
    \onecolumn
    \input{Appendix/psalm-110}
    \input{Appendix/isaiah}
    \input{Appendix/aramaic-in-the-ot}
    \input{Appendix/covenants-in-antiquity}
    \input{Appendix/tetragrammaton}
    \@openrighttrue\makeatother
    \twocolumn
\end{document}
